#!/usr/bin/env bash

set -ex

RUBY_VERSION="3.3"
RAILS_VERSION="7.1"

mkdir -p ./public/wasm

JS=true bin/rbwasm build --ruby-version ${RUBY_VERSION} -o ./public/wasm/ruby-${RUBY_VERSION}-web.wasm

bin/rbwasm pack ./public/wasm/ruby-${RUBY_VERSION}-web.wasm \
  --dir ./app::/app \
  --dir ./config::/config \
  --dir ./db::/db \
  --dir ./vendor::/vendor \
  --dir ./public::/public \
  --dir ./lib::/lib \
  -o ./public/wasm/rails-${RAILS_VERSION}-ruby-${RUBY_VERSION}-web.wasm
